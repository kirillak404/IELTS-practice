{% extends "layout.html" %}
{% block title %}
Speaking practice
{% endblock %}
{% block h1 %}
Speaking practice
{% endblock %}
{% block h1_classes %}
text-center
{% endblock %}
{% block content %}


<div class="container">
   <div class="content">
      <div class="d-flex justify-content-between flex-wrap mb-5">
         <p class="lead">
            {{ result.general_feedback }}
         </p>
         <table class="table">
            <thead>
               <tr>
                  <th scope="col">Criterion</th>
                  <th scope="col">Score</th>
                  <th scope="col">Feedback</th>
               </tr>
            </thead>
            <tbody>
               <tr>
                  <td>Fluency and Coherence</td>
                  <td>{{ result.fluency_coherence_score }}</td>
                  <td>{{ result.fluency_coherence_feedback }}</td>
               </tr>
               <tr>
                  <td>Grammatical Range and Accuracy</td>
                  <td>{{ result.grammatical_range_accuracy_score }}</td>
                  <td>{{ result.grammatical_range_accuracy_feedback }}</td>
               </tr>
               <tr>
                  <td>Lexical Resource</td>
                  <td>{{ result.lexical_resource_score }}</td>
                  <td>{{ result.lexical_resource_feedback }}</td>
               </tr>
               <tr>
                  <td>Pronunciation</td>
                  <td>{{ result.pronunciation_score }}</td>
                  <td>{{ result.pronunciation_feedback }}</td>
               </tr>
            </tbody>
         </table>
      </div>
      {% for item in questions_and_answers %}
      <h5>{{item.question}}</h5>
      <p class="text-justify lead">{{item.answer_with_errors|safe}}</p>
      <hr/>
      {% endfor %}
   </div>
</div>


<div class="toast">
    <div class="toast-header">
        <strong class="mr-auto"></strong> <!-- data-error-type will be inserted here -->
    </div>
    <div class="toast-body">
        <!-- Error explanation, wrong and corrected text will be inserted here -->
    </div>
</div>
</div>

<script>
$(document).ready(function() {
    $('.error').on('mouseenter', function(e) {
        $('.toast').stop();
        var top = e.pageY;
        var left = e.pageX;

        $('.toast').css({top: (top - $('.toast').height() - 10) + 'px', left: (left + 10) + 'px'});

        var errorType = $(this).data('error-type').charAt(0).toUpperCase() + $(this).data('error-type').slice(1);
        $('.toast-header strong').html(errorType);

        var struckText = '<span class="struck">' + $(this).text() + '</span>';
        var arrowIcon = '<i class="bi bi-arrow-right"></i>';
        var correctedText = '<span class="corrected">' + $(this).data('corrected-text') + '</span>';
        var explanation = '<br>' + $(this).data('error-long-description');
        $('.toast-body').html(struckText + ' ' + arrowIcon + ' ' + correctedText + explanation);

        $('.toast').fadeIn(250);
    });

    $('.error').on('mouseleave', function() {
        $('.toast').fadeOut(250);
    });
});
</script>


{% endblock %}