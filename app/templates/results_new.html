{% extends "layout.html" %}
{% block title %}
Speaking practice
{% endblock %}
{% block h1 %}
Speaking practice
{% endblock %}
{% block h1_classes %}
text-center
{% endblock %}
{% block content %}


<div class="container container_1000px">
   <table class="table table-bordered text-center">
      <thead class="table-heading">
         <tr>
            <th class="w-25 fs-5 criteria-heading">
               Accuracy Score
               <a href="#" data-toggle="tooltip" data-placement="top" title="Pronunciation accuracy of the speech. Accuracy indicates how closely the phonemes match a native speaker's pronunciation."><i class="bi bi-question-circle"></i></a>
            </th>
            <th class="w-25 fs-5 criteria-heading">
               Fluency Score
               <a href="#" data-toggle="tooltip" data-placement="top" title="Fluency of the given speech. Fluency indicates how closely the speech matches a native speaker's use of silent breaks between words."><i class="bi bi-question-circle"></i></a>
            </th>
            <th class="w-25 fs-5 criteria-heading">
               Completeness Score
               <a href="#" data-toggle="tooltip" data-placement="top" title="Completeness of the speech."><i class="bi bi-question-circle"></i></a>
            </th>
            <th class="w-25 fs-5 criteria-heading">
               Pronunciation Score
               <a href="#" data-toggle="tooltip" data-placement="top" title="Overall score indicating the pronunciation quality of the given speech."><i class="bi bi-question-circle"></i></a>
            </th>
         </tr>
      </thead>
      <tbody>
         <tr>
            <td class="fs-4 score" data-score="{{ scores['accuracy_score'] }}">{{ scores['accuracy_score'] }}</td>
            <td class="fs-4 score" data-score="{{ scores['fluency_score'] }}">{{ scores['fluency_score'] }}</td>
            <td class="fs-4 score" data-score="{{ scores['completeness_score'] }}">{{ scores['completeness_score'] }}</td>
            <td class="fs-4 score" data-score="{{ scores['pronunciation_score'] }}">{{ scores['pronunciation_score'] }}</td>
         </tr>
      </tbody>
   </table>
</div>
<div class="container d-flex justify-content-center container_1000px">
   <div class="card text-left">
      <div class="card-body">
         <div class="card-text">
            {% for answer in answers %}
            <div class="dialogue">
               <p class="question">{{ answer.question.text }}</p>
               <p class="answer">{{ convert_answer_object_to_html(answer)|safe }}</p>
            </div>
            {% endfor %}
         </div>
      </div>
   </div>
</div>

<div class="toast">
    <div class="toast-header">
        <strong class="mr-auto"></strong> <!-- data-error-type will be inserted here -->
    </div>
    <div class="toast-body">
        <!-- Error explanation, wrong and corrected text will be inserted here -->
    </div>
</div>
</div>



<!-- Инициализация tooltip -->
<script>
   $(function () {
     $('[data-toggle="tooltip"]').tooltip();

     // Функция для изменения цвета оценки
     function setColor() {
       $('.score').each(function() {
         var score = parseInt($(this).data('score'));

         if (score >= 90) {
           $(this).css('color', 'green'); // Отлично (зеленый цвет)
         } else if (score >= 80) {
           $(this).css('color', 'limegreen'); // Хорошо (светло-зеленый цвет)
         } else if (score >= 70) {
           $(this).css('color', 'orange'); // Средне (оранжевый цвет)
         } else {
           $(this).css('color', 'red'); // Ниже среднего (красный цвет)
         }
       });
     }

     // Изменение цвета оценок при загрузке страницы
     setColor();
   });
</script>

<script>
$(document).ready(function() {
    $('.error').on('mouseenter', function(e) {
        $('.toast').stop();
        var top = e.pageY;
        var left = e.pageX;

        $('.toast').css({top: (top - $('.toast').height() - 10) + 'px', left: (left + 10) + 'px'});

        var errorType = $(this).data('error-type').charAt(0).toUpperCase() + $(this).data('error-type').slice(1);
        $('.toast-header strong').html(errorType);

        var accuracy = '';
        if ($(this).data('accuracy-score')) {
            accuracy = '<b>Score: </b>' + $(this).data('accuracy-score') + '<br>';
        }

        var explanation = '<b>Description: </b>' + $(this).data('error-long-description');
        $('.toast-body').html(accuracy + ' ' + ' ' + explanation);

        $('.toast').fadeIn(250);
    });

    $('.error').on('mouseleave', function() {
        $('.toast').fadeOut(250);
    });
});
</script>


{% endblock %}